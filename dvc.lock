schema: '2.0'
stages:
  prepare:
    cmd: python -m scripts.prepare
    deps:
    - path: data/all.csv
      md5: a79bcf8affd28ae57eee3fd38f872faa
      size: 128402973
    - path: scripts/prepare.py
      md5: 20524be787ecc0bd3158a7a4cdaf20a7
      size: 477
    params:
      params.yaml:
        basic:
          vocab_size: 50000
          min_freq: 3
    outs:
    - path: outputs/config.json
      md5: b475a25ba02680cc35f445c7f4b571e9
      size: 85
    - path: outputs/vocab.plk
      md5: d1d7dd5445ea139f986675be21f6a4f9
      size: 872687
  inference@mlp:
    cmd: python -m scripts.inference mlp
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/config.json
      md5: b475a25ba02680cc35f445c7f4b571e9
      size: 85
    - path: outputs/mlp_checkpoint.pth
      md5: 126d8aebdce4e616ce585b0055e1cd8a
      size: 26921107
    - path: scripts/inference.py
      md5: 6009800af49693dcf5ea45a0415b071b
      size: 1970
    outs:
    - path: outputs/mlp_submission.csv
      md5: cfff14d87841c7c5d44ca2ae6578ac47
      size: 330570
  inference@lstm:
    cmd: python -m scripts.inference lstm
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/config.json
      md5: b475a25ba02680cc35f445c7f4b571e9
      size: 85
    - path: outputs/lstm_checkpoint.pth
      md5: fdc05da24348e77beda95b0cc2d0ffce
      size: 69723667
    - path: scripts/inference.py
      md5: 6009800af49693dcf5ea45a0415b071b
      size: 1970
    outs:
    - path: outputs/lstm_submission.csv
      md5: 98bbc0400205ae607e65f8c302a7c1ee
      size: 330692
  inference@cnn:
    cmd: python -m scripts.inference cnn
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/cnn_checkpoint.pth
      md5: 3f1690058c3c432329453ef733de978b
      size: 25602311
    - path: outputs/config.json
      md5: cdb8221e0e5eb1a11d5f25ff535fcc38
      size: 85
    - path: scripts/inference.py
      md5: 3824553fe72926fced071bd91ad71d90
      size: 1980
    outs:
    - path: outputs/cnn_submission.csv
      md5: 5ec4bc3440cd7a2887bba1a08e29fcd8
      size: 258587
  validate@mlp:
    cmd: python -m scripts.validate mlp
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: outputs/config.json
      md5: 833365f54b55ee1829588de2567d1bf7
      size: 85
    - path: outputs/vocab.plk
      md5: 23ba90394b758ae7f60257b9bc7d5506
      size: 1494895
    - path: scripts/validate.py
      md5: 06be09580d4ce344e850a0c5aa8121b8
      size: 2769
    params:
      params.yaml:
        mlp:
          embed_dim: 128
          use_bag: true
          hidden_size: 512
          dropout: 0.1
        validate:
          batch_size: 256
          shuffle: true
          epochs: 5
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 0.0001
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/mlp_validate_plots.csv
      md5: cbc3bc78748e4f1cd5dba7747fa2684e
      size: 279
    - path: outputs/mlp_validate_results.json
      md5: eb090e4414bdf9f238e8d215ed7601f6
      size: 155
  validate@cnn:
    cmd: python -m scripts.validate cnn
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: outputs/config.json
      md5: cdb8221e0e5eb1a11d5f25ff535fcc38
      size: 85
    - path: outputs/vocab.plk
      md5: 14284264890cd690d7bad61190b39ce0
      size: 966319
    - path: scripts/validate.py
      md5: 0e3aa787e0e2ae0f08dd8aa491d696d0
      size: 3588
    params:
      params.yaml:
        cnn:
          embed_dim: 128
          use_bag: false
          hidden_size: 512
          kernel_size: 3
          n_layers: 4
          dropout: 0.33
          max_len: 512
        validate:
          batch_size: 64
          shuffle: true
          epochs: 10
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 0.001
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 1e-06
    outs:
    - path: outputs/cnn_validate_plots.csv
      md5: 048c5d6e8f768602d6c2261687507772
      size: 3839
    - path: outputs/cnn_validate_results.json
      md5: d1a11ca141476d800617b31736d666f8
      size: 127
  validate_bert@basic:
    cmd: python -m scripts.validate_bert basic
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/validate_bert.py
      md5: b8d7c28900ead5fc89eb87b5c55d6f16
      size: 2429
    params:
      params.yaml:
        bert.basic:
          pretrained_model: bert-base-uncased
          hidden_size: 768
          dropout: 0.1
        bert.max_len: 128
        validate:
          batch_size: 32
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-basic_validate_plots.csv
      md5: 261b5f5d6626b9760f6eb3a7731959a4
      size: 232
    - path: outputs/bert-basic_validate_results.json
      md5: 83e3f47932d2cc95584327703d8fb775
      size: 154
  validate_bert@lstm:
    cmd: python -m scripts.validate_bert lstm
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/validate_bert.py
      md5: b8d7c28900ead5fc89eb87b5c55d6f16
      size: 2429
    params:
      params.yaml:
        bert.lstm:
          pretrained_model: bert-base-uncased
          bert_hidden_size: 768
          hidden_size: 512
          dropout: 0.1
          n_layers: 2
          attention_method: concat
        bert.max_len: 128
        validate:
          batch_size: 32
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-lstm_validate_plots.csv
      md5: d83ef3404423476ecedefd9019213112
      size: 234
    - path: outputs/bert-lstm_validate_results.json
      md5: f1f0542a879a1862dcf82eb17790e629
      size: 153
  train_bert@lstm:
    cmd: python -m scripts.train_bert bert lstm
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/train_bert.py
      md5: 28fb5beb554be9c9253586dab639ec0f
      size: 1943
    params:
      params.yaml:
        bert.lstm:
          bert_hidden_size: 768
          hidden_size: 512
          dropout: 0.1
          n_layers: 2
          attention_method: concat
        bert.max_len: 128
        bert.pretrained_model: bert-base-uncased
        train:
          batch_size: 32
          shuffle: true
          epochs: 4
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-lstm_checkpoint.pth
      md5: 2adea24bf1a1c5648c0a12bf852433ce
      size: 530373919
    - path: outputs/bert-lstm_plots.csv
      md5: 5a2f68ca26ced5e3b82c52a23f736a27
      size: 171
    - path: outputs/bert-lstm_results.json
      md5: f0227ac6257fb301b759ab0b619cbbb0
      size: 156
  inference_bert@lstm:
    cmd: python -m scripts.inference_bert bert lstm
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/bert-lstm_checkpoint.pth
      md5: 2adea24bf1a1c5648c0a12bf852433ce
      size: 530373919
    - path: scripts/inference_bert.py
      md5: 4253ac549774d38db305a9097228c108
      size: 1898
    outs:
    - path: outputs/bert-lstm_submission.csv
      md5: 9d080c140238e6adbeb7ef78c54ede21
      size: 419729
  validate_xlnet@basic:
    cmd: python -m scripts.validate_bert xlnet basic
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/validate_bert.py
      md5: e162b3b5f8716c7dabfbb413c67652d3
      size: 2719
    params:
      params.yaml:
        validate:
          batch_size: 32
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
        xlnet.basic:
          hidden_size: 768
          dropout: 0.1
        xlnet.max_len: 128
        xlnet.pretrained_model: xlnet-base-cased
    outs:
    - path: outputs/xlnet-basic_validate_plots.csv
      md5: 078516f43a751c7149d4e1b2b3200a5d
      size: 232
    - path: outputs/xlnet-basic_validate_results.json
      md5: 011b99a5eaf6ec1ad0d3b649e7bd8c63
      size: 154
  validate_bert@bert-base-uncased_basic:
    cmd: python -m scripts.validate_bert bert bert-base-uncased basic
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: model/bert/basic.py
      md5: 7e5f25a5a50a46ea6c93949ce3fb861d
      size: 1324
    - path: scripts/validate_bert.py
      md5: 20660b0b12c7342e4f7368d4ee146275
      size: 2789
    params:
      params.yaml:
        bert.basic:
          dropout: 0.1
        bert.do_lower_case: true
        bert.max_len: 128
        validate:
          batch_size: 32
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-bert-base-uncased-basic_validate_plots.csv
      md5: 195596b5c128026c2d7d1deddca5842c
      size: 230
    - path: outputs/bert-bert-base-uncased-basic_validate_results.json
      md5: b929aa837f251b320db1660e94b8d723
      size: 153
  validate_bert@bert-large-uncased_basic:
    cmd: python -m scripts.validate_bert bert bert-large-uncased basic
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: model/bert/basic.py
      md5: 7e5f25a5a50a46ea6c93949ce3fb861d
      size: 1324
    - path: scripts/validate_bert.py
      md5: 20660b0b12c7342e4f7368d4ee146275
      size: 2789
    params:
      params.yaml:
        bert.basic:
          dropout: 0.1
        bert.do_lower_case: true
        bert.max_len: 128
        validate:
          batch_size: 16
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-bert-large-uncased-basic_validate_plots.csv
      md5: af3870c50430090aa4e8f776cf9fb0ec
      size: 229
    - path: outputs/bert-bert-large-uncased-basic_validate_results.json
      md5: 7df7cd93c728bd527170a51f6e34618c
      size: 156
  validate_bert@bert-base-uncased_lstm:
    cmd: python -m scripts.validate_bert bert bert-base-uncased lstm
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: model/bert/lstm.py
      md5: 09610a8fecd1493281715631401a86a2
      size: 1897
    - path: scripts/validate_bert.py
      md5: 20660b0b12c7342e4f7368d4ee146275
      size: 2789
    params:
      params.yaml:
        bert.do_lower_case: true
        bert.lstm:
          hidden_size: 768
          dropout: 0.1
          n_layers: 2
          attention_method: concat
        bert.max_len: 128
        validate:
          batch_size: 32
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-bert-base-uncased-lstm_validate_plots.csv
      md5: aeea9348fc6e16aa332767a1bc5598be
      size: 228
    - path: outputs/bert-bert-base-uncased-lstm_validate_results.json
      md5: 1810c78d585d2b3f8faf5e555232dfe1
      size: 153
  train@mlp:
    cmd: python -m scripts.train mlp
    deps:
    - path: data/all.csv
      md5: a79bcf8affd28ae57eee3fd38f872faa
      size: 128402973
    - path: outputs/config.json
      md5: b475a25ba02680cc35f445c7f4b571e9
      size: 85
    - path: outputs/vocab.plk
      md5: d1d7dd5445ea139f986675be21f6a4f9
      size: 872687
    - path: scripts/train.py
      md5: e24786983fccaa1a2d5a88a8f68d4256
      size: 2261
    params:
      params.yaml:
        mlp:
          embed_dim: 128
          use_bag: true
          hidden_size: 512
          dropout: 0.1
        train:
          batch_size: 128
          shuffle: true
          epochs: 10
          optimizer:
            lr: 0.001
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0.0001
    outs:
    - path: outputs/mlp_checkpoint.pth
      md5: 126d8aebdce4e616ce585b0055e1cd8a
      size: 26921107
    - path: outputs/mlp_plots.csv
      md5: 7edeb8e35a8cee099176ff800fba77f0
      size: 359
    - path: outputs/mlp_results.json
      md5: b200ed1aa1a6dec2c005d05bf4dc5013
      size: 156
  train@lstm:
    cmd: python -m scripts.train lstm
    deps:
    - path: data/all.csv
      md5: a79bcf8affd28ae57eee3fd38f872faa
      size: 128402973
    - path: outputs/config.json
      md5: b475a25ba02680cc35f445c7f4b571e9
      size: 85
    - path: outputs/vocab.plk
      md5: d1d7dd5445ea139f986675be21f6a4f9
      size: 872687
    - path: scripts/train.py
      md5: e24786983fccaa1a2d5a88a8f68d4256
      size: 2261
    params:
      params.yaml:
        lstm:
          embed_dim: 128
          use_bag: false
          use_eos: true
          attention_method: concat
          hidden_size: 512
          n_layers: 2
          dropout: 0.1
          max_len: 256
        train:
          batch_size: 128
          shuffle: true
          epochs: 5
          optimizer:
            lr: 0.0001
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0.0001
    outs:
    - path: outputs/lstm_checkpoint.pth
      md5: fdc05da24348e77beda95b0cc2d0ffce
      size: 69723667
    - path: outputs/lstm_plots.csv
      md5: 7b6bcef6350556128ebdcbae5bb28713
      size: 200
    - path: outputs/lstm_results.json
      md5: bbc7a3f6830727f4cfe44364dfef671a
      size: 153
  train_bert@bert-large-uncased_basic:
    cmd: python -m scripts.train_bert bert bert-large-uncased basic
    deps:
    - path: data/all.csv
      md5: a79bcf8affd28ae57eee3fd38f872faa
      size: 128402973
    - path: model/bert/basic.py
      md5: 7e5f25a5a50a46ea6c93949ce3fb861d
      size: 1324
    - path: scripts/train_bert.py
      md5: 4ba03138d877f6f38a86941290b57dbe
      size: 2514
    params:
      params.yaml:
        bert.basic:
          dropout: 0.1
        bert.do_lower_case: true
        bert.max_len: 128
        train:
          batch_size: 16
          shuffle: true
          epochs: 4
          optimizer:
            lr: 1e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0.0001
    outs:
    - path: outputs/bert-bert-large-uncased-basic_checkpoint.pth
      md5: f40ab022c89742710955b5c7733cb866
      size: 1344932329
    - path: outputs/bert-bert-large-uncased-basic_plots.csv
      md5: 36a656a69e9045210fb74db7d3154538
      size: 166
    - path: outputs/bert-bert-large-uncased-basic_results.json
      md5: 18e16fb594057a2c4926499aa49d6a0e
      size: 155
  inference_bert@bert-large-uncased_basic:
    cmd: python -m scripts.inference_bert bert bert-large-uncased basic
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/bert-bert-large-uncased-basic_checkpoint.pth
      md5: f40ab022c89742710955b5c7733cb866
      size: 1344932329
    - path: scripts/inference_bert.py
      md5: d5b171f34e217e480d336e92222a1ded
      size: 2152
    outs:
    - path: outputs/bert-bert-large-uncased-basic_submission.csv
      md5: db157ccf248b56a4cac176e95085188b
      size: 229245
  train_roberta@roberta-large_basic:
    cmd: python -m scripts.train_bert roberta roberta-large basic
    deps:
    - path: data/all.csv
      md5: a79bcf8affd28ae57eee3fd38f872faa
      size: 128402973
    - path: model/roberta/basic.py
      md5: 2c8632ca917584d6f8799ebe1483cb92
      size: 1330
    - path: scripts/train_bert.py
      md5: 4cfa4bacc4a848148004d0bf3e63e0be
      size: 2590
    params:
      params.yaml:
        roberta.basic:
          dropout: 0.1
        roberta.do_lower_case: true
        roberta.max_len: 128
        train:
          batch_size: 16
          shuffle: true
          epochs: 6
          early_stops: 2
          optimizer:
            lr: 2e-05
            step_lr: 500
            gamma: 0.5
            clip: 1.0
            weight_decay: 1e-05
    outs:
    - path: outputs/roberta-roberta-large-basic_checkpoint.pth
      md5: 32746b7a10b19bb892ec3a032da549f0
      size: 1425803817
    - path: outputs/roberta-roberta-large-basic_plots.csv
      md5: 4cc8f9cf64e867b116dac693ad45d686
      size: 312
    - path: outputs/roberta-roberta-large-basic_results.json
      md5: 40b071c1cdcd5956174a353ff6184fb3
      size: 153
  inference_roberta@roberta-large_basic:
    cmd: python -m scripts.inference_bert roberta roberta-large basic
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/roberta-roberta-large-basic_checkpoint.pth
      md5: 32746b7a10b19bb892ec3a032da549f0
      size: 1425803817
    - path: scripts/inference_bert.py
      md5: dd331f744ebee45890ca3a8106bf48dd
      size: 2254
    outs:
    - path: outputs/roberta-roberta-large-basic_submission.csv
      md5: ab7d6928f5b468080b464df4282708cc
      size: 229245
  train_xlnet@xlnet-large-cased_basic:
    cmd: python -m scripts.train_bert xlnet xlnet-large-cased basic
    deps:
    - path: data/all.csv
      md5: a79bcf8affd28ae57eee3fd38f872faa
      size: 128402973
    - path: model/xlnet/basic.py
      md5: 7c902712cffc82cf7005db19912dbf65
      size: 1518
    - path: scripts/train_bert.py
      md5: 4cfa4bacc4a848148004d0bf3e63e0be
      size: 2590
    params:
      params.yaml:
        train:
          batch_size: 8
          shuffle: true
          epochs: 6
          early_stops: 2
          optimizer:
            lr: 2e-05
            step_lr: 500
            gamma: 0.5
            clip: 1.0
            weight_decay: 1e-05
        xlnet.basic:
          dropout: 0.1
        xlnet.do_lower_case: true
        xlnet.max_len: 128
    outs:
    - path: outputs/xlnet-xlnet-large-cased-basic_checkpoint.pth
      md5: 99ac993f83fb9e03f20c72b61ebe5e0b
      size: 1445421701
    - path: outputs/xlnet-xlnet-large-cased-basic_plots.csv
      md5: 2c110acac84dca78d4b82994f551b24d
      size: 310
    - path: outputs/xlnet-xlnet-large-cased-basic_results.json
      md5: dab15eda010dacdd9eec534795aa467a
      size: 154
  inference_xlnet@xlnet-large-cased_basic:
    cmd: python -m scripts.inference_bert xlnet xlnet-large-cased basic
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/xlnet-xlnet-large-cased-basic_checkpoint.pth
      md5: 99ac993f83fb9e03f20c72b61ebe5e0b
      size: 1445421701
    - path: scripts/inference_bert.py
      md5: dd331f744ebee45890ca3a8106bf48dd
      size: 2254
    outs:
    - path: outputs/xlnet-xlnet-large-cased-basic_submission.csv
      md5: 0bed9eb6bb98e18658641303f5059919
      size: 229245
