schema: '2.0'
stages:
  prepare:
    cmd: python -m scripts.prepare
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/prepare.py
      md5: 20524be787ecc0bd3158a7a4cdaf20a7
      size: 477
    params:
      params.yaml:
        basic:
          vocab_size: 30000
          min_freq: 3
    outs:
    - path: outputs/vocab.plk
      md5: 14284264890cd690d7bad61190b39ce0
      size: 966319
  inference@mlp:
    cmd: python -m scripts.inference mlp
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/config.json
      md5: cdb8221e0e5eb1a11d5f25ff535fcc38
      size: 85
    - path: outputs/mlp_checkpoint.pth
      md5: 9699c2342b1409780088fd07edd0b70e
      size: 7162613
    - path: scripts/inference.py
      md5: 3824553fe72926fced071bd91ad71d90
      size: 1921
    outs:
    - path: outputs/mlp_submission.csv
      md5: 943c0f54813c561fe54980e1fc8d3111
      size: 229245
  inference@lstm:
    cmd: python -m scripts.inference lstm
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/config.json
      md5: cdb8221e0e5eb1a11d5f25ff535fcc38
      size: 85
    - path: outputs/lstm_checkpoint.pth
      md5: 785c2e464f3ef25054a7de19dc888835
      size: 59488551
    - path: scripts/inference.py
      md5: 3824553fe72926fced071bd91ad71d90
      size: 1980
    outs:
    - path: outputs/lstm_submission.csv
      md5: 292a1e8932ab032a297633ad9eaa49d7
      size: 258587
  inference@cnn:
    cmd: python -m scripts.inference cnn
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/cnn_checkpoint.pth
      md5: 3f1690058c3c432329453ef733de978b
      size: 25602311
    - path: outputs/config.json
      md5: cdb8221e0e5eb1a11d5f25ff535fcc38
      size: 85
    - path: scripts/inference.py
      md5: 3824553fe72926fced071bd91ad71d90
      size: 1980
    outs:
    - path: outputs/cnn_submission.csv
      md5: 5ec4bc3440cd7a2887bba1a08e29fcd8
      size: 258587
  validate@mlp:
    cmd: python -m scripts.validate mlp
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: outputs/config.json
      md5: cdb8221e0e5eb1a11d5f25ff535fcc38
      size: 85
    - path: outputs/vocab.plk
      md5: 14284264890cd690d7bad61190b39ce0
      size: 966319
    - path: scripts/validate.py
      md5: 0e3aa787e0e2ae0f08dd8aa491d696d0
      size: 3588
    params:
      params.yaml:
        mlp:
          embed_dim: 50
          use_bag: true
          hidden_size: 512
          dropout: 0.1
        validate:
          batch_size: 64
          shuffle: true
          epochs: 20
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 1e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0.0001
    outs:
    - path: outputs/mlp_validate_plots.csv
      md5: 0592e05b4529a989c0f09b021c71362b
      size: 9537
    - path: outputs/mlp_validate_results.json
      md5: b7e4f996e2dea315f050bed0fdf7acca
      size: 127
  validate@cnn:
    cmd: python -m scripts.validate cnn
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: outputs/config.json
      md5: cdb8221e0e5eb1a11d5f25ff535fcc38
      size: 85
    - path: outputs/vocab.plk
      md5: 14284264890cd690d7bad61190b39ce0
      size: 966319
    - path: scripts/validate.py
      md5: 0e3aa787e0e2ae0f08dd8aa491d696d0
      size: 3588
    params:
      params.yaml:
        cnn:
          embed_dim: 128
          use_bag: false
          hidden_size: 512
          kernel_size: 3
          n_layers: 4
          dropout: 0.33
          max_len: 512
        validate:
          batch_size: 64
          shuffle: true
          epochs: 10
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 0.001
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 1e-06
    outs:
    - path: outputs/cnn_validate_plots.csv
      md5: 048c5d6e8f768602d6c2261687507772
      size: 3839
    - path: outputs/cnn_validate_results.json
      md5: d1a11ca141476d800617b31736d666f8
      size: 127
  validate_bert@basic:
    cmd: python -m scripts.validate_bert basic
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/validate_bert.py
      md5: b8d7c28900ead5fc89eb87b5c55d6f16
      size: 2429
    params:
      params.yaml:
        bert.basic:
          pretrained_model: bert-base-uncased
          hidden_size: 768
          dropout: 0.1
        bert.max_len: 128
        validate:
          batch_size: 32
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-basic_validate_plots.csv
      md5: 261b5f5d6626b9760f6eb3a7731959a4
      size: 232
    - path: outputs/bert-basic_validate_results.json
      md5: 83e3f47932d2cc95584327703d8fb775
      size: 154
  validate_bert@lstm:
    cmd: python -m scripts.validate_bert lstm
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/validate_bert.py
      md5: b8d7c28900ead5fc89eb87b5c55d6f16
      size: 2429
    params:
      params.yaml:
        bert.lstm:
          pretrained_model: bert-base-uncased
          bert_hidden_size: 768
          hidden_size: 512
          dropout: 0.1
          n_layers: 2
          attention_method: concat
        bert.max_len: 128
        validate:
          batch_size: 32
          shuffle: true
          epochs: 4
          kfold: 10
          early_stops: 3
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-lstm_validate_plots.csv
      md5: d83ef3404423476ecedefd9019213112
      size: 234
    - path: outputs/bert-lstm_validate_results.json
      md5: f1f0542a879a1862dcf82eb17790e629
      size: 153
  train_bert@lstm:
    cmd: python -m scripts.train_bert bert lstm
    deps:
    - path: data/train.csv
      md5: d0d12f53a232828404431f2416df09fe
      size: 33430132
    - path: scripts/train_bert.py
      md5: 28fb5beb554be9c9253586dab639ec0f
      size: 1943
    params:
      params.yaml:
        bert.lstm:
          bert_hidden_size: 768
          hidden_size: 512
          dropout: 0.1
          n_layers: 2
          attention_method: concat
        bert.max_len: 128
        bert.pretrained_model: bert-base-uncased
        train:
          batch_size: 32
          shuffle: true
          epochs: 4
          optimizer:
            lr: 2e-05
            step_lr: 2.0
            gamma: 0.5
            clip: 1.0
            weight_decay: 0
    outs:
    - path: outputs/bert-lstm_checkpoint.pth
      md5: 2adea24bf1a1c5648c0a12bf852433ce
      size: 530373919
    - path: outputs/bert-lstm_plots.csv
      md5: 5a2f68ca26ced5e3b82c52a23f736a27
      size: 171
    - path: outputs/bert-lstm_results.json
      md5: f0227ac6257fb301b759ab0b619cbbb0
      size: 156
  inference_bert@lstm:
    cmd: python -m scripts.inference_bert bert lstm
    deps:
    - path: data/test.csv
      md5: 8ba62e41af40f5b5f9e9ed83e5ee3f2a
      size: 33708755
    - path: outputs/bert-lstm_checkpoint.pth
      md5: 2adea24bf1a1c5648c0a12bf852433ce
      size: 530373919
    - path: scripts/inference_bert.py
      md5: ac5ded39605f6ab0e976b7a852405a6e
      size: 1767
    outs:
    - path: outputs/bert-lstm_submission.csv
      md5: c1cf05f5009e946b8c3bd28a2a8df9c3
      size: 258587
